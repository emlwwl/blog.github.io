---
title: MySQL索引
date: 2021-04-14 15:05:55
tags: MySQL
categories: 
- MySQL
---

## 一、什么是索引？ 

拿汉语字典的目录页（索引）打比方，我们可以按拼音、笔画、偏旁部首等排序的目录（索引）快速查找到需要的字。

## 二、索引的优缺点?

**优点：**

1、索引可以大大提高MySQL的检索速度。

2、所有的MySql列类型(字段类型)都可以被索引，可以给任意字段设置索引 

<!--more-->

**缺点：**

1、虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存索引文件。
2、建立索引会占用磁盘空间的索引文件。一般情况这个问题不太严重，但如果你在一个大表上创建了多种组合索引，索引文件的会膨胀很快。
3、对于离散度较差的数据，为它建立索引就没有太大的实际效果。比如：性别字段
4、对于非常小的表，大部分情况下简单的全表扫描更高效。

## 三、索引的分类

#### 按列来区分：

索引分**单列索引**和**复合索引**。

单列索引：即一个索引只包含单个列，一个表可以有多个单列索引，但这不是组合索引。

复合索引：即一个索引包含多个列。

---

**注1：复合索引有哪些好处？**

**减少开销：**建一个复合索引 (Gid,Cid,SId) ，实际相当于建了 (Gid)、(Gid,Cid)、(Gid,Cid,SId) 三个索引。每多一个索引，都会增加写操作的开销和磁盘空间的开销。对于大量数据的表，使用复合索引会大大的减少开销！ 

**覆盖索引：**`select Gid,Cid,SId from student where Gid =1 and Cid =2`。那么MySQL可以直接通过遍历索引取得数据，而无需回表，这减少了很多的随机IO操作。减少IO操作，特别的随机IO其实是DBA主要的优化策略。所以，在真正的实际应用中，覆盖索引是主要的提升性能的优化手段之一。 

**效率高：**索引列越多，通过索引筛选出的数据越少。有1000W条数据的表，有如下sql:`select from table where Gid =1 and Cid =2 and SId =3`,假设假设每个条件可以筛选出10%的数据，如果只有单值索引，那么通过该索引能筛选出1000W10%=100w条数据，然后再回表从100w条数据中找到符合` Gid =2 and Cid = 3`的数据，然后再排序，再分页；如果是复合索引，通过索引筛选出1000w10% 10% *10%=1w，效率提升可想而知！ 

**缺点：**复合索引越多，索引列越多，则创建的索引越多，索引都是存储在磁盘里的，通过索引算法 BTree代表索引算法使用二叉树的形式来做索引的)来查找数据，的确可以极大的提高查询效率，但是与此同时增删改的同时，需要更新索引，同样是需要花时间的，并且索引所占的磁盘空间也不小。 

**建议：**单表尽可能不要超过一个复合索引，单列索引不超过3个

**注2：复合索引的注意事项**
1、**最左前缀匹配原则：** 非常重要的原则，mysql会一直向右匹配直到遇到范围查询(>、<、between、 like)就停止匹配，比如a = 1 and b = 2 and c > 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。 
2、=和in可以乱序，比如a = 1 and b = 2 and c = 3 建立(a,b,c)索引可以任意顺序，mysql的查询优化器会 帮你优化成索引可以识别的形式。 

---

####  按数据存储方式区分：

索引分**聚簇索引**和**非聚簇索引**

聚簇索引：聚簇索引就是按照每张表的主键构造一颗B+树 。 同时叶子节点中存放的就是整张表的行记录数据，也将聚集索引的叶子节点称为数据页。 这个特性决定了索引组织表中数据也是索引的一部分，每张表只能拥有一个聚簇索引。 

----

**注**：Innodb通过主键聚集数据，如果没有定义主键，innodb会选择非空的唯一索引代替。如果没有这样的索引，innodb会隐式的定义一个主键来作为聚簇索引。 

---

非聚簇索引：聚簇索引之上创建的索引称之为非聚簇索引（也称为辅助索引）。辅助索引访问数据需要二次查找，辅助索引叶子节点存储的不再是行的物理位置，而是主键值。通过辅助索引首先找到的是主键值，再通过主键值找到数据行的数据页（这个过程叫**回表**）

#### 按作用区分

**主键索引（primary key）：**也简称主键，提供唯一性约束并不允许为空。一张表中只能有一个主键。被标记为自动增长的字段一定是主键，但主键不一定是自动增长。一般把主键定义在无意义的字段上（如：编号）

**普通索引（normal）：**普通索引是最基本的索引，它没有任何限制，值可以为空，仅加速查询

**唯一索引（unique）：** 唯一索引与普通索引类似，不同的就是：索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一 

**全文索引（fulltext）：**全文索引主要用来查找文本中的关键字，而不是直接与索引中的值相比较。fulltext索引跟其它索引大不相同，它更像是一个搜索引擎 

**空间索引（spatial）：**MySQL在5.7之后的版本支持了空间索引，而且支持OpenGIS几何数据模型。这是在地理位置领域使用的一种索引，其他场景用的很少

## 四、MySQL索引失效的几种情况 

1、有or必全有索引;

2、复合索引未用左列字段; 

3、like以%开头;

4、需要类型转换; 

5、where中索引列有运算; 

6、where中索引列使用了函数; 

7、如果mysql觉得全表扫描更快时（数据少）; 

