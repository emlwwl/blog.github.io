---
title: Redis持久化
date: 2021-03-19 17:05:55
tags: Redis
categories: 
- Redis
---

## 一、概念

**什么是持久化？**

redis的高性能很大程度上得益于所有的数据存储在了内存上，但是当redis重启后，所有存储在内存上的数据都会丢失，所以我们提供了两种把redis数据备份到硬盘上的方式，当redis重启后由硬盘上的数据恢复到redis的数据，这就是持久化的过程。

**不是所有的redis都要持久化**

某些情况我们只需要当做缓存使用就可以不持久化，比如当热点数据的缓存，session的共享等。 只做缓存，如果你只希望你的数据在服务器运行的时候存在，你也可以不使用任何持久化 。

<!--more-->

## 二、持久化的两种方式

### 1、RDB (Redis Database)

在指定的时间间隔内将内存中的数据集以快照（SnapShot）的方式写入磁盘，数据恢复是通过快照文件直接读到内存里。rdb保存的文件是dump.rdb

#### a. 触发机制

redis.conf配置文件中有如下配置，用户可以更改。 

```
#这三个条件是或的关系，表示在
#900秒内有1个或以上的键被改动
#300秒内有10条或以上的键被改动
#60秒内有10000条及以上键被改动时触发快照。
save 900 1
save 300 10
save 60 10000
```

**注：当用户执行save和bgsave/lastsave命令以及fushall命令时，也会被动触发rdb** 

#### b. 恢复rdb文件 

1、只需要将rdb文件放在我们redis启动目录就可以，redis启动的时候会自动检查dump.rdb 恢复其中 的数据！ 2、查看需要存在的位置 

#### c. 优缺点

优点： 1、适合大规模的数据恢复！ 2、对数据的完整性要不高！

缺点： 如果redis意外宕机了，这个最后一次修改数据就没有的了！只能保留到最后一个的save的地方。 

### AOF (apeend only file)

AOF方式会将redis的每一条命令追加到硬盘文件中。简而言之就是记录日志

以日志的形式来记录每个写操作，将Redis执行过的所有指令记录下来（读操作不记录），只许追加文件，但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作。aof保存的是appendonly.aof文件

**aof默认是关闭的,需要手动进行配置**

```
#redis.conf文件中
appendonly yes
```


**优点：**

1、每一次修改都同步，文件的完整会更加好！可以设置

2、每秒同步一次，可能会丢失一秒的数据！默认3、从不同步，效率最高的！

**缺点：**

1、相对于数据文件来说，aof远远大于rdb，修复的速度也比rdb慢！

2、aof运行效率也要比rdb慢，所以我们redis默认的配置就是rdb持久化！



